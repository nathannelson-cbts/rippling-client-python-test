# Copilot Instructions for rippling-client-python-test

> Python coding standards and project-specific rules for the Rippling API client test workspace.

---

## Critical Rules

### Virtual Environment (MANDATORY)

**ALL Python commands MUST run inside an activated virtual environment (.venv)**

- Never suggest `pip`, `python`, `pytest`, or any Python tool outside a venv
- Always remind about venv activation when context suggests it may not be active
- Verify with `which python` → should show path inside `.venv/`

```bash
# Activate virtual environment first
source .venv/bin/activate

# Verify activation
which python  # Should show: /path/to/project/.venv/bin/python
```

### NO AI Attribution in Commits

Never include "Generated by", "Co-Authored-By: Claude/GPT/AI", or any AI attribution in commit messages.

### Git Commits (MANDATORY METHOD)

**ALWAYS use the temp file method for git commits — NEVER pass commit messages directly in terminal commands.**

Passing multi-line commit messages (or messages with special characters) directly to `git commit -m` causes terminal hangs and escaping failures. The safe method:

1. **Write message to temp file** using `create_file`:
   ```
   .git/COMMIT_MSG_TEMP
   ```
2. **Commit using the file**:
   ```bash
   git commit -F .git/COMMIT_MSG_TEMP
   ```
3. **Clean up** (optional, file is in .git/ so never tracked):
   ```bash
   rm .git/COMMIT_MSG_TEMP
   ```

**Why this works:**
- `create_file` writes content directly — no shell escaping issues
- `.git/` directory is never tracked by git
- Newlines, quotes, `$`, `!`, backticks all handled correctly
- No terminal hangs from incomplete command parsing

**NEVER do this:**
```bash
# WRONG - will hang or fail on special characters/newlines
git commit -m "line 1
line 2"
echo "message" | git commit -F -
```

### Documentation Sync

- Update `README.md` when adding examples or changing behavior
- Update `.env.example` when adding environment variables
- Keep docstrings current with implementation

---

## Project Overview

`rippling-client-python-test` is a dedicated test workspace for validating and exploring the `rippling-client-python` library. It tests the library from a consumer's perspective using real API calls.

| Attribute | Value |
|-----------|-------|
| Project type | Integration test workspace |
| Python version | 3.11+ |
| Library under test | `rippling-client` (editable install) |
| Logging | structlog (inherited from library) |

### Relationship to Library

This project consumes `rippling-client-python` which is installed in **editable mode**:

```bash
pip install -e /Users/nathan.nelson/Development/rippling-client-python
```

Changes to the library are immediately available without reinstalling.

Refer to [docs/PROJECT_SETUP.md](../docs/PROJECT_SETUP.md) for full setup details.

| Project | Purpose | Tests Type |
|---------|---------|------------|
| `rippling-client-python` | The library itself | Unit tests (mocked HTTP) |
| `rippling-client-python-test` | This project | Integration tests (real API) |

---

## Project Structure

```
rippling-client-python-test/
├── .env                    # Credentials (gitignored, NEVER commit)
├── .env.example            # Template for credentials
├── .venv/                  # Virtual environment
├── README.md               # Project overview
├── test_connection.py      # Basic connectivity test
├── docs/
│   └── PROJECT_SETUP.md    # Setup and development guide
└── examples/
    ├── 01_basic_usage.py       # Getting started
    ├── 02_hr_operations.py     # Workers, departments, teams
    ├── 03_time_attendance.py   # Time entries, time cards
    ├── 04_recruiting.py        # Candidates, applications
    ├── 05_custom_data.py       # Custom objects, custom fields
    ├── 06_async_usage.py       # Async client patterns
    ├── 07_error_handling.py    # Exception handling patterns
    ├── 08_real_world_use_cases.py  # Practical scenarios
    └── 09_interactive_explorer.py  # Interactive REPL-style explorer
```

---

## Code Standards (REQUIRED)

### Type Hints

- **ALL functions MUST have type hints**
- Use modern syntax: `str | None` (not `Optional[str]`), `list[str]` (not `List[str]`)
- Use `dict[str, Any]` not `Dict[str, Any]`

```python
# CORRECT
def list_active_workers(
    client: SyncRipplingClient,
    *,
    department_id: str | None = None,
    limit: int | None = None,
) -> list[Worker]:
    ...

# INCORRECT
from typing import Optional, List
def list_active_workers(
    client,
    department_id: Optional[str] = None,
    limit: Optional[int] = None,
) -> List:
    ...
```

### Docstrings (Google-style)

```python
def get_worker_details(client: SyncRipplingClient, worker_id: str) -> Worker:
    """Retrieve detailed worker information.

    Args:
        client: The Rippling API client instance.
        worker_id: The unique identifier of the worker.

    Returns:
        The Worker object with all available fields.

    Raises:
        RipplingAPIError: If the worker is not found or API returns an error.
    """
```

### Module-Level Docstrings (REQUIRED)

Every example/test file should have a docstring describing its purpose:

```python
"""
HR Operations Examples for Rippling API Client

This script demonstrates working with HR-related resources:
- Workers (employees and contractors)
- Departments (organizational structure)
- Teams (functional groups)

Before running, ensure you have a .env file with RIPPLING_BEARER_TOKEN set.
"""
```

### Code Quality Tools

| Tool | Purpose |
|------|---------|
| Black | Code formatting (line-length=88) |
| Ruff | Linting |
| Mypy | Type checking (optional but recommended) |

---

## Using the Library

### Imports

```python
# Main clients
from rippling_client import AsyncRipplingClient, SyncRipplingClient

# Configuration
from rippling_client import RipplingSettings

# Exceptions (for error handling)
from rippling_client import (
    RipplingError,
    RipplingAPIError,
    RipplingAuthError,
    RipplingRateLimitError,
    RipplingServerError,
    RipplingTimeoutError,
)

# Models (for type hints)
from rippling_client.models import Worker, Company, Department
```

### Exception Hierarchy

When catching exceptions, use the appropriate type:

```python
class RipplingError(Exception):
    """Base exception with context dict and cause chaining."""

class RipplingAPIError(RipplingError):
    """4xx API errors (business rejections)."""
    status_code: int

class RipplingAuthError(RipplingError):
    """401 Unauthorized or 403 Forbidden."""

class RipplingRateLimitError(RipplingError):
    """429 Too Many Requests."""
    retry_after: float | None

class RipplingServerError(RipplingError):
    """5xx errors after retries exhausted."""

class RipplingTimeoutError(RipplingError):
    """Request timeout after retries exhausted."""
```

### Error Handling Pattern

```python
from rippling_client import (
    SyncRipplingClient,
    RipplingSettings,
    RipplingAPIError,
    RipplingAuthError,
    RipplingRateLimitError,
)

try:
    with SyncRipplingClient(settings=settings) as client:
        workers = list(client.workers.list())
except RipplingAuthError as e:
    print(f"Authentication failed: {e}")
    print("Check your RIPPLING_BEARER_TOKEN")
except RipplingRateLimitError as e:
    print(f"Rate limited. Retry after: {e.retry_after}s")
except RipplingAPIError as e:
    print(f"API error (HTTP {e.status_code}): {e}")
```

---

## Configuration Pattern

### Environment Variables

All prefixed with `RIPPLING_`:

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `RIPPLING_BEARER_TOKEN` | **Yes** | — | Bearer token |
| `RIPPLING_BASE_URL` | No | `https://rest.ripplingapis.com` | API base URL |
| `RIPPLING_TIMEOUT_CONNECT` | No | 30.0 | Connect timeout |
| `RIPPLING_TIMEOUT_READ` | No | 60.0 | Read timeout |
| `RIPPLING_MAX_RETRIES` | No | 3 | Max retry attempts |
| `RIPPLING_MAX_CONCURRENT` | No | 50 | Max concurrent requests |

### Loading Settings

```python
import os
from dotenv import load_dotenv
from rippling_client import RipplingSettings

# Load from .env file
load_dotenv()

# Create settings explicitly
settings = RipplingSettings(
    bearer_token=os.getenv('RIPPLING_BEARER_TOKEN'),
    base_url=os.getenv('RIPPLING_BASE_URL', 'https://rest.ripplingapis.com'),
)
```

---

## Example File Template

Use this template when creating new examples:

```python
#!/usr/bin/env python3
"""
[Title] Examples for Rippling API Client

[Description of what this example demonstrates]

Before running, ensure you have a .env file with RIPPLING_BEARER_TOKEN set.
"""

import os
import sys
from dotenv import load_dotenv

# Load environment variables from .env file
load_dotenv()

from rippling_client import SyncRipplingClient, RipplingSettings, RipplingAPIError


def get_settings() -> RipplingSettings:
    """Load settings from environment variables."""
    bearer_token = os.getenv('RIPPLING_BEARER_TOKEN')
    if not bearer_token:
        print("ERROR: RIPPLING_BEARER_TOKEN environment variable is required")
        print("Set it in your .env file or export it in your shell")
        sys.exit(1)
    
    base_url = os.getenv('RIPPLING_BASE_URL', 'https://rest.ripplingapis.com')
    
    return RipplingSettings(
        bearer_token=bearer_token,
        base_url=base_url,
    )


def main() -> None:
    """Main entry point."""
    print("=" * 60)
    print("[Example Title]")
    print("=" * 60)
    
    settings = get_settings()
    
    with SyncRipplingClient(settings=settings) as client:
        # Your example code here
        pass


if __name__ == "__main__":
    try:
        main()
    except RipplingAPIError as e:
        print(f"\n❌ API Error: {e}")
        sys.exit(1)
    except KeyboardInterrupt:
        print("\n\nInterrupted by user")
        sys.exit(0)
```

---

## Development Commands

```bash
# ALWAYS activate venv first
source .venv/bin/activate

# Verify the library is installed in editable mode
pip show rippling-client

# Test basic connectivity
python test_connection.py

# Run an example
python examples/01_basic_usage.py

# Format code
black examples/ test_connection.py

# Lint code (optional)
ruff check examples/ test_connection.py
```

---

## Workflow: When the Library Needs Changes

If you encounter a bug or need an enhancement in the library:

### 1. Identify the Issue
Run an example, observe the error or unexpected behavior.

### 2. Fix in the Library
Make changes in `rippling-client-python/src/rippling_client/`

### 3. Test Immediately
Run the same example again — changes are picked up automatically (editable install).

### 4. Run Library Unit Tests
```bash
cd /Users/nathan.nelson/Development/rippling-client-python
source .venv/bin/activate
make test
```

### 5. Commit Both Projects (if needed)
- Commit the fix to `rippling-client-python`
- Commit updated tests/examples to `rippling-client-python-test`

---

## Conventional Commits (REQUIRED)

**Format**: `<type>(<scope>): <description>`

| Type | Use Case |
|------|----------|
| `feat` | New example or test |
| `fix` | Bug fix in examples |
| `docs` | Documentation updates |
| `style` | Formatting (no code change) |
| `refactor` | Code refactoring |
| `test` | Adding/modifying tests |
| `chore` | Maintenance tasks |

### Examples

```
feat(examples): add time tracking example
fix(connection): handle missing token gracefully
docs(readme): add troubleshooting section
test(workers): add bulk retrieval test
```

---

## Security

- **NEVER commit `.env` file** — contains real API credentials
- Ensure `.env` is in `.gitignore`
- Maintain `.env.example` with placeholder values only
- Never print bearer tokens in example output

---

## When Writing Examples/Tests

1. Include complete type hints
2. Add Google-style docstrings
3. Handle errors gracefully with user-friendly messages
4. Use meaningful variable names
5. Add comments explaining non-obvious behavior
6. Follow existing patterns in the codebase
7. Update README.md if adding new examples
8. Update `.env.example` if needing new env vars

---

## Quick Reference

| Aspect | Standard |
|--------|----------|
| Python Version | 3.11+ |
| Project Layout | Flat (examples/, docs/) |
| Formatter | Black (88 chars) |
| Linter | Ruff (optional) |
| Env Management | python-dotenv + .env |
| Commits | Conventional Commits |
| Secrets | .env file (gitignored) |

---

## Key Files Reference

| Purpose | File |
|---------|------|
| Project setup guide | [docs/PROJECT_SETUP.md](../docs/PROJECT_SETUP.md) |
| Quick connectivity test | `test_connection.py` |
| Basic usage patterns | `examples/01_basic_usage.py` |
| Environment template | `.env.example` |

### Library Reference (in rippling-client-python)

| Purpose | File |
|---------|------|
| Design Decisions | `docs/DESIGN.md` |
| Implementation Status | `docs/TODO.md` |
| Library Coding Standards | `.github/copilot-instructions.md` |
| Main Client | `src/rippling_client/client.py` |
| Exceptions | `src/rippling_client/exceptions.py` |
| Configuration | `src/rippling_client/config.py` |
| Models | `src/rippling_client/models/` |
| Resources | `src/rippling_client/resources/` |
